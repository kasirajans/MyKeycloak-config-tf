# PKCE Clients Configuration for SP-Customer Realm
# This client acts as an OAuth broker connecting to IdP-Customer realm

realm: sp-customer

# Mapper Configuration Guide:
# 
# 1. user_attribute mapper - Maps user attributes to JWT claims
#    - name: Unique mapper name
#    - user_attribute: Source attribute from user profile (email, firstName, lastName, username)
#    - claim_name: Target claim name in JWT token (email, given_name, family_name, preferred_username)
#
# 2. audience mapper - Adds audience claim to token
#    - name: Unique mapper name
#    - audience: Target audience (use "self" for client's own client_id, or specify a UUID)
#
# Note: If no mappers are defined, a default audience mapper will be created automatically.

clients:
  - client_id: mobile-web-app-broker
    name: Mobile/Web App Broker Client
    description: |
      PKCE client for mobile/web apps that brokers authentication through SP-Customer 
      to IdP-Customer realm. This implements the broker pattern:
      [Mobile/Web] → [SP-Keycloak PKCE Client] → [IdP-Keycloak Authorization Server]
    enabled: true
    
    # PKCE settings
    pkce:
      challenge_method: S256  # SHA-256
    
    # Redirect URIs - Your mobile/web app callback URLs
    redirect_uris:
      - http://localhost:5173/callback
      - http://localhost:3000/callback
      - http://localhost:8081/callback  # Mobile app
      - http://localhost:4200/callback  # Angular app
      - myapp://callback                # Mobile deep link
    
    # CORS web origins - Your web app origins
    web_origins:
      - http://localhost:5173
      - http://localhost:3000
      - http://localhost:8081
      - http://localhost:4200
    
    # Valid post-logout redirect URIs for Single Logout (SLO)
    valid_post_logout_redirect_uris:
      - http://localhost:5173
    # Token settings (in seconds)
    token_settings:
      access_token_lifespan: 300      # 5 minutes
      session_idle_timeout: 1800      # 30 minutes
      session_max_lifespan: 36000     # 10 hours
    
    # Additional settings
    consent_required: false
    
    # Protocol Mappers (optional)
    mappers:
      - type: user_attribute
        name: email
        user_attribute: email
        claim_name: email
      
      - type: user_attribute
        name: firstName
        user_attribute: firstName
        claim_name: given_name
      
      - type: user_attribute
        name: lastName
        user_attribute: lastName
        claim_name: family_name
      
      - type: user_attribute
        name: username
        user_attribute: username
        claim_name: preferred_username
      
      - type: audience
        name: audience
        audience: self  # Use "self" for client's own client_id
